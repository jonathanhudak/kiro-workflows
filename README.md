# Kiro Workflows

Multi-agent development workflows for [Kiro CLI](https://kiro.dev/cli/), inspired by [antfarm](https://github.com/snarktank/antfarm).

One command runs the full pipeline — planning, implementation, verification, testing, review, and learnings extraction. The [Ralph loop](https://github.com/snarktank/ralph) runs under the hood.

<img src="https://raw.githubusercontent.com/snarktank/ralph/main/ralph.webp" alt="Ralph" width="80">

## Install

```bash
# Clone and install globally
git clone https://github.com/jonathanhudak/kiro-workflows.git
cd kiro-workflows
npm install
npm run build
npm link
```

This gives you the `kiro-workflow` command globally.

## Quick Start

```bash
# Initialize agents + steering in your project
cd /your/project
kiro-workflow init

# Or use setup.sh directly
./setup.sh /path/to/your/project

# Or symlink instead of copy (updates when you pull)
./setup.sh --symlink /path/to/your/project

# Customize steering for your codebase (auto-generated by setup.sh)
# Edit .kiro/steering/structure.md, tech.md, product.md as needed

# Run a workflow interactively
./workflow-runner.sh

# Or run a specific workflow directly
./workflow-runner.sh --run feature-dev
```

## Setup

### `setup.sh`

Installs `.kiro/` agents, steering, hooks, and settings into your project directory. Optionally analyzes your codebase to generate project-specific steering files.

```bash
# Basic usage — copy .kiro/ into target project
./setup.sh /path/to/project

# Symlink mode — .kiro/ points back to this repo (stays in sync)
./setup.sh --symlink /path/to/project

# Force overwrite existing .kiro/ without prompting
./setup.sh --force /path/to/project

# Show help
./setup.sh --help
```

**What it does:**

1. **Detects kiro-cli** — warns if not installed (non-blocking)
2. **Copies or symlinks `.kiro/`** into the target directory
3. **Analyzes your codebase** — reads `package.json`, `tsconfig.json`, directory structure
4. **Generates steering files** — `structure.md` and `tech.md` are populated with your project's actual stack, build commands, and directory layout
5. **Validates agent JSON** — runs `validate-agents.sh` to ensure all agent files are well-formed

**Steering generation** works best with `jq` installed but falls back to `grep`/`sed` if unavailable.

### `workflow-runner.sh`

Interactive workflow runner that guides you through multi-agent workflows step by step.

```bash
# Interactive mode — select workflow, step through agents
./workflow-runner.sh

# Run a specific workflow
./workflow-runner.sh --run feature-dev
./workflow-runner.sh --run bug-fix
./workflow-runner.sh --run security-audit

# Resume from a specific step
./workflow-runner.sh --run feature-dev --from 3

# Check progress of current workflow
./workflow-runner.sh --status

# List available workflows
./workflow-runner.sh --list

# Show help
./workflow-runner.sh --help
```

**Interactive mode features:**

- Select from three workflows (Feature Dev, Bug Fix, Security Audit)
- Each step shows the agent name, description, and `kiro-cli` command to run
- Press Enter to advance, `s` to skip, `q` to quit
- Progress is tracked in `.kiro/progress.md`

**Progress tracking:**

The runner creates `.kiro/progress.md` in your project directory with:
- Workflow name and start time
- Each step's status: `○` pending, `▶` in-progress, `✓` done, `⊘` skipped
- Completion timestamp when finished
- Use `--status` to view progress anytime

## How It Works

```
workflow-runner.sh --run feature-dev
    │
    ├── 1. Planner agent breaks task into stories
    │      (each small enough for one agent session)
    │
    ├── 2. Ralph Loop (for each story):
    │      ├── Developer agent implements (fresh session)
    │      ├── Verifier agent checks acceptance criteria
    │      ├── FAIL? → retry with feedback (up to 3x)
    │      └── PASS? → next story
    │
    ├── 3. Tester agent runs test suite
    ├── 4. Reviewer agent reviews all changes
    └── 5. Compound agent extracts learnings
           → updates .kiro/steering/learnings.md
```

Each agent runs in a **fresh session with clean context**. Memory persists only through git history and steering files — the Ralph pattern.

## Workflows

### `feature-dev`
Plan, implement, test, and review a new feature.
```
planner → developer (loop) → tester → reviewer → compound
```

### `bug-fix`
Triage, investigate, fix, and verify a bug.
```
triager → investigator → developer (loop) → reviewer → compound
```

### `security-audit`
Scan, prioritize, fix, and test security issues.
```
scanner → triager → fixer (loop) → tester → reviewer → compound
```

## Agents

10 specialized agents live in `.kiro/agents/`:

| Agent | Role |
|-------|------|
| **planner** | Feature planner — breaks down requirements into specs, design docs, and implementation tasks |
| **developer** | Implementation agent — writes code from task specs following project conventions |
| **reviewer** | Code reviewer — checks quality, patterns, security, and correctness with structured severity output |
| **verifier** | Verification agent — validates acceptance criteria, runs tests, and gates workflow progression |
| **tester** | Test engineer — writes and maintains test suites |
| **triager** | Bug triager — classifies severity, identifies affected components, assigns priority |
| **investigator** | Root-cause analyst — traces bugs to their source through code and logs |
| **scanner** | Security scanner — identifies vulnerabilities in code and dependencies |
| **fixer** | Security fixer — applies remediation for identified vulnerabilities |
| **compound** | Learnings extractor — reviews completed work and writes structured learning files |

All agent prompts are battle-tested with detailed methodology sections, structured output formats, and explicit "What NOT to Do" guidelines. See [CONTRIBUTING.md](CONTRIBUTING.md) for how to add or customize agents.

## Steering Files

Steering files in `.kiro/steering/` give agents persistent project context:

| File | Purpose |
|------|---------|
| `structure.md` | Codebase architecture and directory layout |
| `tech.md` | Tech stack, patterns, build/test commands |
| `product.md` | Business context and requirements |
| `workflows.md` | How the multi-agent pipeline operates |
| `learnings.md` | Auto-updated insights from past runs |

`setup.sh` copies templates and generates `structure.md` and `tech.md` from your codebase. Customize them for your project.

## The Learnings Loop

The **compound agent** runs after every workflow and:
1. Reviews git diff and commit history
2. Identifies what worked, what didn't, and surprises
3. Writes structured YAML-frontmatter learning files to `docs/learnings/`
4. Future runs load these learnings automatically

Each workflow makes the next one smarter.

## Examples

See the [examples/](examples/) directory for complete workflow walkthroughs with expected input/output for each agent step. Start with [examples/feature-dev-workflow/](examples/feature-dev-workflow/) for a full feature development run.

## Hooks

Hooks in `.kiro/hooks/` automate common triggers:

| Hook | Trigger | Action |
|------|---------|--------|
| `pre-commit` | Before git commit | Validates all agent JSON files |
| `post-merge` | After git merge/PR | Runs scanner + tester agents |
| `post-review` | After code review | Routes feedback to developer agent |

## MCP Configuration

`.kiro/settings/mcp.json` includes common MCP server configs for filesystem, git, and GitHub access. Customize for your project's needs (databases, APIs, etc.).

## Customization

### Add project-specific steering

```markdown
<!-- .kiro/steering/api-standards.md -->
# API Standards
- REST with JSON:API spec
- All endpoints require authentication
- Rate limiting: 100 req/min per user
```

### Configure MCP servers

```json
// .kiro/settings/mcp.json
{
  "mcpServers": {
    "database": {
      "command": "mcp-server-postgres",
      "args": ["--host", "localhost"]
    }
  }
}
```

### Add custom agents

Drop a JSON file in `.kiro/agents/` — see [CONTRIBUTING.md](CONTRIBUTING.md) for the full guide.

## Compared to Antfarm

| | Antfarm (OpenClaw) | Kiro Workflows |
|---|---|---|
| **Runtime** | OpenClaw daemon + SQLite + cron | Kiro CLI (terminal) |
| **Orchestration** | Autonomous cron polling | CLI-driven with interactive runner |
| **Agent sessions** | Fresh per cron tick | Fresh per story (same pattern) |
| **Learnings** | `docs/learnings/*.md` | `.kiro/steering/learnings.md` |
| **Auth** | N/A (local) | AWS IAM Identity Center |
| **Use case** | Personal projects | Enterprise / work projects |

## Prerequisites

- [Kiro CLI](https://kiro.dev/cli/) installed (`curl -fsSL https://cli.kiro.dev/install | bash`)
- Git
- bash 3.2+ (macOS default works)
- jq (optional, improves setup.sh steering generation)

## Contributing

See [CONTRIBUTING.md](CONTRIBUTING.md) for instructions on adding new agents, workflows, hooks, and steering files.

## License

MIT
